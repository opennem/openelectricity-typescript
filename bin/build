#!/usr/bin/env bash

set -exuo pipefail

cd "$(dirname "$0")/.."

# Clean dist directory
rm -rf dist

# Build for Node.js (CommonJS)
tsc -p tsconfig.node.json

# Build for Browser (ES Modules)
tsc -p tsconfig.browser.json

# Create package.json for the dist folder
cat >dist/package.json <<EOF
{
  "name": "@openelectricity/client",
  "version": "$(node -p "require('./package.json').version")",
  "description": "OpenElectricity API Typescript/Javascript client",
  "main": "./node/index.js",
  "module": "./browser/index.js",
  "types": "./node/index.d.ts",
  "exports": {
    ".": {
      "require": "./node/index.js",
      "import": "./browser/index.js",
      "types": "./node/index.d.ts"
    }
  },
  "sideEffects": false,
  "license": "MIT"
}
EOF

# Copy documentation files
cp README.md LICENSE dist/
